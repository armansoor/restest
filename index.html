<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>THE RESISTANCE: AI PROTOCOL</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
</head>
<body>

    <div class="container">
        <header>
            <h1>THE RESISTANCE</h1>
            <div class="status-bar">
                <span id="game-status-text">SYSTEM OFFLINE</span>
            </div>
        </header>

        <div id="screen-menu" class="screen active">
            <div class="card">
                <h2>Mode Selection</h2>
                <div class="form-group">
                    <label>Your Codename</label>
                    <input type="text" id="player-name-input" placeholder="Enter Agent Name" value="Agent 007">
                </div>
                <button class="btn" id="btn-mode-single">Single Player (vs AI)</button>
                <button class="btn" id="btn-mode-multi">Multiplayer (LAN/P2P)</button>
                <button class="btn btn-outline" id="btn-rules">Mission Briefing (Rules)</button>
            </div>
        </div>

        <div id="screen-role-reveal" class="screen">
            <div class="card" style="text-align: center; padding: 40px;">
                <h2>TOP SECRET</h2>
                <p>Your identity for this mission is:</p>
                <h1 id="reveal-role-text" style="font-size: 3em; margin: 30px 0;">...</h1>
                <div id="reveal-allies" style="margin-bottom: 30px; color: #aaa;"></div>
                <button class="btn" id="btn-reveal-confirm">I Understand</button>
            </div>
        </div>

        <div id="screen-single-setup" class="screen">
            <div class="card">
                <h2>Single Player Setup</h2>
                <div class="form-group">
                    <label>Total Players (5-10)</label>
                    <select id="setup-players">
                        <option value="5">5 Players (2 Spies)</option>
                        <option value="6">6 Players (2 Spies)</option>
                        <option value="7">7 Players (3 Spies)</option>
                        <option value="8">8 Players (3 Spies)</option>
                        <option value="9">9 Players (3 Spies)</option>
                        <option value="10">10 Players (4 Spies)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>AI Difficulty</label>
                    <select id="setup-difficulty">
                        <option value="normal">Normal</option>
                        <option value="hard">Hard</option>
                    </select>
                </div>
                <button class="btn" id="btn-start-single">Start Mission</button>
                <button class="btn btn-outline" id="btn-back-menu">Back</button>
            </div>
        </div>

        <div id="screen-lobby" class="screen">
            <div class="card">
                <h2>Multiplayer Lobby</h2>
                <div id="lobby-options">
                    <button class="btn" id="btn-host-game">Host Game</button>
                    <div style="margin: 20px 0; border-top: 1px solid #444;"></div>
                    <div class="form-group">
                        <label>Join Game (Room ID)</label>
                        <input type="text" id="join-room-id" placeholder="Enter Host ID">
                    </div>
                    <button class="btn" id="btn-join-game">Join Game</button>
                </div>

                <div id="lobby-host-area" style="display:none;">
                    <h3>Room ID: <span id="host-room-id" style="color:var(--gold)">Generating...</span></h3>
                    <p>Share this ID with other players.</p>
                    <div id="lobby-player-list" style="margin: 20px 0; min-height: 50px; background: #222; padding: 10px;">
                        Waiting for players...
                    </div>
                    <div class="form-group">
                        <label>Total Players Needed: <span id="lobby-count">0</span>/5+</label>
                        <select id="setup-multi-total">
                            <option value="5">5 Players</option>
                            <option value="6">6 Players</option>
                            <option value="7">7 Players</option>
                            <option value="8">8 Players</option>
                            <option value="9">9 Players</option>
                            <option value="10">10 Players</option>
                        </select>
                    </div>
                    <button class="btn" id="btn-start-multi" disabled>Start Game</button>
                </div>
                 <button class="btn btn-outline" id="btn-back-menu-lobby">Back</button>
            </div>
        </div>

        <div id="screen-rules" class="screen">
            <div class="card">
                <h2>Mission Briefing</h2>
                <p><strong>OBJECTIVE:</strong> The Resistance must succeed 3 missions. The Spies must cause 3 missions to fail.</p>
                <ul style="text-align: left; margin-bottom: 20px;">
                    <li><strong>Team Building:</strong> The Leader proposes a team.</li>
                    <li><strong>Voting:</strong> Everyone votes to Approve/Reject the team. Majority rules.</li>
                    <li><strong>The Mission:</strong> 
                        <ul>
                            <li>Resistance MUST support success.</li>
                            <li>Spies may Fail or Support (to bluff).</li>
                        </ul>
                    </li>
                </ul>
                <p class="alert-box"><strong>WARNING:</strong> The AI is designed to win. On Hard mode, Spies will gain your trust before betraying you on the final mission.</p>
                <button class="btn" id="btn-back-menu">Back to Menu</button>
            </div>
        </div>


        <div id="screen-game" class="screen">
            <div class="mission-track" id="mission-track">
                </div>

            <div class="card" id="action-area">
                <h3 id="phase-title">Phase: Setup</h3>
                <p id="phase-desc">Waiting...</p>
                <div id="action-buttons"></div>
            </div>

            <button class="btn btn-outline" id="btn-show-history" style="margin-bottom: 10px;">Mission Logs & History</button>

            <h3>Operatives</h3>
            <div class="player-grid" id="player-grid">
                </div>

            <h3>Mission Log</h3>
            <div id="game-log"></div>

            <div id="chat-container" style="display:none; margin-top: 20px; border-top: 1px solid #444; padding-top: 10px;">
                <h3>Comm Link</h3>
                <div id="chat-messages" style="height: 100px; overflow-y: auto; background: #111; padding: 5px; font-size: 0.8rem; color: #ccc;"></div>
                <div style="display:flex; gap: 5px; margin-top: 5px;">
                    <input type="text" id="chat-input" placeholder="Secure message..." style="flex:1;">
                    <button class="btn" id="btn-send-chat" style="width: auto; margin-bottom:0;">Send</button>
                </div>
            </div>
        </div>

        <div id="screen-history" class="screen">
            <div class="card">
                <h2>Mission History</h2>
                <div id="history-container" style="overflow-x: auto;">
                    <table id="history-table" style="width:100%; border-collapse: collapse; color: #eee;">
                        <thead>
                            <tr style="border-bottom: 1px solid #555;">
                                <th style="padding:8px; text-align:left;">Mission</th>
                                <th style="padding:8px; text-align:left;">Leader</th>
                                <th style="padding:8px; text-align:left;">Team</th>
                                <th style="padding:8px; text-align:left;">Votes</th>
                                <th style="padding:8px; text-align:left;">Result</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
                <button class="btn btn-outline" id="btn-close-history" style="margin-top:20px;">Close</button>
            </div>
        </div>
    </div>

    <script type="module" src="js/main.js"></script>
</body>
</html>
